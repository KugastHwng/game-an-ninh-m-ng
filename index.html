<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>H√†nh tr√¨nh an to√†n m·∫°ng</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
body { margin:0; font-family:'Poppins', sans-serif; overflow:hidden; background: linear-gradient(#6bd5ff, #b9f1ff); }

/* INTRO */
#introContainer,#outroScreen { width:100vw; height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:20px; box-sizing:border-box; }
#outroScreen { display:none; flex-direction:column; justify-content:center; align-items:center; text-align:center; animation: bgFade 5s ease-in-out infinite; }

#introText { max-width:800px; color:#004760; font-size:20px; line-height:1.6; }

/* Name input */
#nameBox { display:none; margin-top:20px; text-align:center; }
#playerName { padding:10px; font-size:18px; border-radius:10px; border:2px solid #5ab4ff; }

/* H∆∞·ªõng d·∫´n tr√™n th√°p */
#towerGuide { text-align:center; font-size:20px; color:#004b70; margin-top:20px; display:none; }

/* GAME */
#gameTitle { display:none; text-align:center; margin-top:20px; color:#0077c8; }
.game-area { display:none; flex-direction:row; justify-content:center; align-items:flex-end; gap:20px; margin-top:20px; position:relative; height:400px; }
.tower { width:120px; height:150px; border-radius:20px 20px 0 0; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; cursor:pointer; position:relative; box-shadow:0 8px 20px rgba(0,0,0,0.25); transition:0.3s; }
.tower:hover { transform: scale(1.05); }
.roof { width:120px; height:40px; clip-path: polygon(50% 0%, 100% 100%, 0% 100%); margin-bottom:0; box-shadow:0 4px 10px rgba(0,0,0,0.3); }

#tower1 { background:#ffe5b4; } #tower1 .roof { background:#ff7f50; }
#tower2 { background:#d0f0c0; } #tower2 .roof { background:#32cd32; }
#tower3 { background:#c0d6f0; } #tower3 .roof { background:#1e90ff; }
#tower4 { background:#f4c2c2; } #tower4 .roof { background:#ff4500; }

.character { width:50px; height:50px; background:#ffeb3b; border-radius:50%; position:absolute; display:flex; align-items:center; justify-content:center; font-size:24px; z-index:5; transition:0.3s; }

/* POPUP */
.popup { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:20px; border-radius:15px; box-shadow:0 8px 25px rgba(0,0,0,0.35); display:none; z-index:10; width:350px; max-width:90vw; }
.popup h2 { margin-top:0; color:#0077c8; }
.popup button { width:100%; padding:12px; background:#00a8ff; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; margin-top:5px; }
.popup button:hover { background:#0077c8; }

.tower.level1 { box-shadow:0 0 10px 3px gold; height:200px; }
.tower.level2 { box-shadow:0 0 15px 5px orange; height:250px; }
.tower.level3 { box-shadow:0 0 25px 8px red; height:300px; }

/* small styles for video/quiz popups */
#congratsPopup .line { margin:8px 0; color:#073b4c; }
#videoPopup video { width:100%; height:auto; border-radius:8px; background:#000; }
.quiz-answers { margin-top:12px; display:flex; flex-direction:column; gap:8px; }
.quiz-answers button, .quiz-answers .submit-btn { width:100%; padding:10px; border-radius:8px; border:none; cursor:pointer; font-weight:600; }
.checkbox-row { display:flex; flex-direction:column; gap:6px; margin-top:8px; text-align:left; }

/* Gradient animation outro */
@keyframes bgFade {
  0% { background: linear-gradient(#6bd5ff, #b9f1ff); }
  50% { background: linear-gradient(#b9f1ff, #6bd5ff); }
  100% { background: linear-gradient(#6bd5ff, #b9f1ff); }
}
</style>
</head>
<body>

<!-- === NH·∫†C N·ªÄN === -->
<audio id="bgMusic" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

<!-- === √ÇM THANH ƒê√öNG ‚Äì SAI === -->
<audio id="correctSound">
  <source src="correct.mp3" type="audio/mpeg">
</audio>

<audio id="wrongSound">
  <source src="wrong.mp3" type="audio/mpeg">
</audio>

<!-- INTRO -->
<div id="introContainer">
  <div id="introText"></div>
  <div id="nameBox">
    <label>Nh·∫≠p t√™n c·ªßa b·∫°n:</label><br>
    <input id="playerName" type="text"><br>
    <button onclick="startGame()">B·∫Øt ƒë·∫ßu</button>
  </div>
</div>

<!-- N√öT HI·ªÇN TH·ªä H∆Ø·ªöNG D·∫™N -->
<div style="text-align:center; margin-top:10px;">
  <button id="towerGuideBtn" style="padding:10px 16px; background:#00a8ff; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:600;" onclick="openTowerGuide()">H∆∞·ªõng d·∫´n Th√°p</button>
</div>

<!-- POPUP H∆Ø·ªöNG D·∫™N -->
<div id="towerGuidePopup" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:50; justify-content:center; align-items:center; padding:20px; display:flex;">
  <div style="background:#fff; max-width:700px; width:100%; border-radius:12px; padding:20px; box-shadow:0 12px 35px rgba(0,0,0,0.35); overflow:auto; max-height:80vh;">
    <h2 style="margin-top:0; color:#0077c8;">H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng ‚Äî 4 t√≤a th√°p</h2>
    <p><strong>M·ª•c ti√™u:</strong> Tr·∫£ l·ªùi ƒë√∫ng c√°c c√¢u h·ªèi ƒë·ªÉ n√¢ng c·∫•p 4 t√≤a th√°p l√™n m·ª©c t·ªëi ƒëa.</p>
    <ol style="text-align:left; padding-left:18px;">
      <li><strong>Nh·∫≠p t√™n:</strong> Nh·∫≠p t√™n r·ªìi nh·∫•n <em>B·∫Øt ƒë·∫ßu</em>.</li>
      <li><strong>Ch·ªçn t√≤a th√°p:</strong> Nh·∫•p v√†o t√≤a th√°p b·∫°n mu·ªën tr·∫£ l·ªùi.</li>
      <li><strong>Tr·∫£ l·ªùi 1 c√¢u:</strong> M·ªói th√°p ch·ªâ c√≥ 1 c√¢u h·ªèi, ch·ªçn 1 trong 3 ƒë√°p √°n.</li>
      <li><strong>N√¢ng c·∫•p :</strong> N·∫øu ƒë√∫ng, th√°p s·∫Ω ƒë·∫°t m·ª©c t·ªëi ƒëa ngay.</li>
      <li><strong>Th·ª≠ l·∫°i khi sai:</strong> N·∫øu sai, c√≥ th√¥ng b√°o, b·∫°n c√≥ th·ªÉ th·ª≠ l·∫°i.</li>
      <li><strong>Ho√†n th√†nh tr√≤ ch∆°i:</strong> Khi c·∫£ 4 th√°p ƒë·ªÅu ƒë·∫°t m·ª©c t·ªëi ƒëa, m√†n kh√°c s·∫Ω xu·∫•t hi·ªán.</li>
    </ol>
    <p style="font-size:13px; color:#555; margin-top:10px;">B·∫°n c√≥ th·ªÉ l√†m th√°p theo b·∫•t k·ª≥ th·ª© t·ª± n√†o. Tr√≤ ch∆°i s·∫Ω ƒë·∫øm th·ªùi gian b·∫°n ch∆°i khi b·∫°n nh·∫•n b·∫Øt ƒë·∫ßu.</p>
    <div style="text-align:right; margin-top:12px;">
      <button style="padding:10px 16px; background:#ff6b6b; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:600;" onclick="closeTowerGuide()">ƒê√≥ng</button>
    </div>
  </div>
</div>

<!-- H∆∞·ªõng d·∫´n tr√™n th√°p -->
<div id="towerGuide" style="display:none;">
  Ch·ªçn v√†o m·ªói t√≤a th√°p ‚Äî m·ªói t√≤a t∆∞·ª£ng tr∆∞ng cho m·ªôt t√†i kho·∫£n c·ªßa Minh. Nh·∫•p v√†o th√°p ƒë·ªÉ ƒë·∫∑t m·∫≠t kh·∫©u m·∫°nh!
</div>

<!-- GAME -->
<h1 id="gameTitle">Mini Game: Ch·ªçn m·∫≠t kh·∫©u m·∫°nh ƒë·ªÉ n√¢ng c·∫•p th√°p</h1>
<div class="game-area" id="gameArea">
  <div class="tower" id="tower1"><div class="roof"></div></div>
  <div class="tower" id="tower2"><div class="roof"></div></div>
  <div class="tower" id="tower3"><div class="roof"></div></div>
  <div class="tower" id="tower4"><div class="roof"></div></div>
  <div class="character" id="character">üòä</div>
</div>

<!-- POPUP -->
<div class="popup" id="popup">
  <h2 id="questionTitle">Ch·ªçn m·∫≠t kh·∫©u</h2>
  <div id="answers"></div>
</div>

<!-- POPUP CU·ªêI TH√ÅP -->
<div class="popup" id="finalPopup">
  <h2>Ch√∫c m·ª´ng!</h2>
  <p>B·∫°n ƒë√£ gi√∫p Minh ƒë·∫∑t m·∫≠t kh·∫©u m·∫°nh, nh∆∞ng ƒë·ªÉ sau n√†y Minh kh√¥ng ƒë·∫∑t m·∫≠t kh·∫©u y·∫øu n·ªØa, b·∫°n n√™n cho Minh 1 s·ªë l·ªùi khuy√™n.</p>
  <button id="nextGameBtn">ƒê∆∞·ª£c th√¥i</button>
</div>

<!-- POPUP L·ªúI KHUY√äN -->
<div class="popup" id="advicePopup">
  <h2 id="adviceQuestion">C√¢u h·ªèi</h2>
  <div id="adviceAnswers"></div>
</div>

<!-- OUTRO -->
<div id="outroScreen">
  <h1 id="outroTitle" style="opacity:0; transition:opacity 1s;">Thank for playing!</h1>
  <p id="outroText" style="opacity:0; transition:opacity 1s;">B·∫°n ƒë√£ ho√†n th√†nh tr√≤ ch∆°i.H√£y chia s·∫ª cho b·∫°n b√® c√πng ch∆°i nh√©.H·∫πn g·∫∑p l·∫°i!</p>
  <div id="outroCharacter" style="width:80px; height:80px; background:#ffeb3b; border-radius:50%; margin-top:30px; display:flex; justify-content:center; align-items:center; font-size:36px; opacity:0; transition:opacity 1s;">üòä</div>
</div>

<!-- ======= NEW: CONGRATS + VIDEO + QUIZ POPUPS (TH√äM M·ªöI, KH√îNG S·ª¨A GAME) ======= -->

<!-- Congratulation popup (shown when showOutro is called) -->
<div class="popup" id="congratsPopup" style="display:none; width:420px;">
  <h2>Ch√∫c m·ª´ng ‚Äî B·∫°n ƒë√£ ho√†n th√†nh tr√≤ ch∆°i!</h2>
  <p class="line">B·∫°n ƒë√£ gi√∫p Minh c·∫£i thi·ªán b·∫£o m·∫≠t. Xem video ng·∫Øn ƒë·ªÉ hi·ªÉu th√™m t√¨nh hu·ªëng l·ª´a ƒë·∫£o.</p>
  <button id="watchVideoBtn">Xem video h∆∞·ªõng d·∫´n</button>
  <button id="skipToQuizBtn" style="background:#ff6b6b; margin-top:8px;">B·ªè qua video ‚Äî Tr·∫£ l·ªùi c√¢u h·ªèi</button>
</div>

<!-- Video popup -->
<div class="popup" id="videoPopup" style="display:none; width:760px; max-width:95vw;">
  <h2>Video minh h·ªça t√¨nh hu·ªëng l·ª´a ƒë·∫£o</h2>
  <video id="lessonVideo" controls>
    <source src="video.mp4" type="video/mp4">
    Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª video.
  </video>
  <button id="skipVideoBtn" style="margin-top:10px; background:#ff6b6b;">B·ªè qua video</button>
</div>

<!-- Quiz popup (4 c√¢u h·ªèi) -->
<div class="popup" id="quizPopup" style="display:none; width:600px; max-width:95vw;">
  <h2 id="quizTitle">B√†i ki·ªÉm tra nhanh</h2>
  <div id="quizBody" style="margin-top:8px; text-align:left;">
    <!-- N·ªôi dung c√¢u h·ªèi s·∫Ω ƒë∆∞·ª£c ch√®n b·∫±ng JS -->
  </div>
  <div style="margin-top:12px;">
    <button id="nextQuizBtn" style="background:#00a8ff;">Ti·∫øp t·ª•c</button>
  </div>
</div>

<!-- ========================================================================== -->

<script>
// --- INTRO ---
const introLines=["B·∫°n l√† 1 nh√† th√°m hi·ªÉm internet...","Trong l√∫c th√°m hi·ªÉm b·∫°n g·∫∑p Minh ‚Äì 1 ng∆∞·ªùi ƒëang b·ªã nh·ªØng t√™n hacker ƒë√°nh c·∫Øp th√¥ng tin...","Nhi·ªám v·ª• c·ªßa b·∫°n l√† gi√∫p Minh ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u!"];
let lineIndex=0,charIndex=0;
const introText=document.getElementById("introText");
const nameBoxEl=document.getElementById("nameBox");

function typeIntro(){
  introText.innerHTML = ""; 
  lineIndex=0; charIndex=0;

  function typing(){
    if(lineIndex<introLines.length){
      if(charIndex<introLines[lineIndex].length){
        introText.innerHTML+=introLines[lineIndex].charAt(charIndex);
        charIndex++;
        setTimeout(typing,40);
      } else {
        introText.innerHTML+="<br><br>";
        lineIndex++; charIndex=0;
        setTimeout(typing,500);
      }
    } else {
      nameBoxEl.style.display="block";
    }
  }

  typing();
}

// KH√îNG CH·∫†Y INTRO KHI LOAD TRANG N·ªÆA
// window.onload = typeIntro;

// --- NH·∫†C ---
const bgMusic=document.getElementById("bgMusic");
const correctSound=document.getElementById("correctSound");
const wrongSound=document.getElementById("wrongSound");
let bgStart=false;

document.addEventListener("click",()=>{
  if(!bgStart){
    bgMusic.volume=0.5;
    bgMusic.play().catch(()=>{});
    bgStart=true;
  }
});

// --- GAME DATA ---
const towersData = {
  tower1: [{question: "Ch·ªçn m·∫≠t kh·∫©u m·∫°nh.", answers: [{ text: "12345", correct: false },{ text: "Huy3#2025", correct: true },{ text: "abcdef", correct: false }]}],
  tower2: [{question: "Ch·ªçn m·∫≠t kh·∫©u c√≥ s·ªë v√† ch·ªØ vi·∫øt hoa.", answers: [{ text: "Pass1234", correct: true },{ text: "abcdefg", correct: false },{ text: "Password", correct: false }]}],
  tower3: [{question: "Ch·ªçn m·∫≠t kh·∫©u c√≥ ch·ªØ hoa, ch·ªØ th∆∞·ªùng,s·ªë v√† k√Ω t·ª± ƒë·∫∑c bi·ªát.", answers: [{ text: "ABCDEFG", correct: false },{ text: "1234567", correct: false },{ text: "Hoctap@1235", correct: true }]}],
  tower4: [{question: "Ch·ªçn m·∫≠t kh·∫©u ƒë·ªß 8 k√Ω t·ª± tr·ªü l√™n.", answers: [{ text: "12a424a", correct: false },{ text: "SafePassw1", correct: true },{ text: "chamchi@!", correct: false }]}]
};

const towers=document.querySelectorAll('.tower');
const popup=document.getElementById('popup');
const questionTitle=document.getElementById('questionTitle');
const answersDiv=document.getElementById('answers');
const character=document.getElementById('character');
const gameArea=document.getElementById('gameArea');
const gameTitle=document.getElementById('gameTitle');
const towerGuide=document.getElementById('towerGuide');
const finalPopup=document.getElementById('finalPopup');
const advicePopup=document.getElementById('advicePopup');
const adviceQuestionEl=document.getElementById('adviceQuestion');
const adviceAnswersDiv=document.getElementById('adviceAnswers');
const outroScreen=document.getElementById('outroScreen');
const outroChar=document.getElementById('outroCharacter');

let currentTower=null;
let currentLevel={tower1:0,tower2:0,tower3:0,tower4:0};

function startGame(){
  const nameInput=document.getElementById('playerName').value;
  document.getElementById('introContainer').style.display="none";
  towerGuide.style.display="block";
  gameTitle.style.display="block";
  gameArea.style.display="flex";
}

towers.forEach(tower=>{
  tower.addEventListener('click',()=>{
    currentTower=tower.id;
    const rect=tower.getBoundingClientRect();
    const areaRect=gameArea.getBoundingClientRect();
    const x=rect.left-areaRect.left+rect.width/2-character.offsetWidth/2;
    const y=-character.offsetHeight;
    character.style.left=x+'px';
    character.style.top=y+'px';
    showTowerQuestion(currentTower);
  });
});

function showTowerQuestion(towerId){
  const level=currentLevel[towerId];
  if(level>=1){ checkAllTowersCompleted(); return; }
  const q=towersData[towerId][0];
  questionTitle.textContent=q.question;
  answersDiv.innerHTML="";
  q.answers.forEach(ans=>{
    const btn=document.createElement('button');
    btn.textContent=ans.text;
    btn.onclick=()=>checkTowerAnswer(ans.correct);
    answersDiv.appendChild(btn);
  });
  popup.style.display='block';
}

function checkTowerAnswer(isCorrect){
  if(isCorrect){
    correctSound.currentTime=0; correctSound.play();
    alert("Ch·ªçn ƒë√∫ng! Th√°p ƒë∆∞·ª£c n√¢ng c·∫•p üéâ");
    const towerEl=document.getElementById(currentTower);
    currentLevel[currentTower]=3;
    towerEl.classList.add("level3");
  } else { wrongSound.currentTime=0; wrongSound.play(); alert("M·∫≠t kh·∫©u y·∫øu, th·ª≠ l·∫°i üò¢"); }
  popup.style.display='none';
  checkAllTowersCompleted();
}

function checkAllTowersCompleted(){
  const allDone=Object.values(currentLevel).every(l=>l>=1);
  if(allDone){ finalPopup.style.display='block'; }
}

document.getElementById('nextGameBtn').onclick=()=>{ finalPopup.style.display='none'; showAdviceGame(); };

// ---- GAME L·ªúI KHUY√äN ----
const adviceQuestions=[
  {q:"Khi ƒë·∫∑t m·∫≠t kh·∫©u, b·∫°n c·∫ßn ___ ƒë·ªÉ b·∫£o m·∫≠t t·ªët h∆°n.",answers:[
    {text:"s·ª≠ d·ª•ng ch·ªØ hoa, ch·ªØ th∆∞·ªùng, s·ªë v√† k√Ω t·ª± ƒë·∫∑c bi·ªát",correct:true},
    {text:"ch·ªâ d√πng s·ªë",correct:false},
    {text:"d√πng t√™n m√¨nh",correct:false}]},
  {q:"M·∫≠t kh·∫©u n√™n c√≥ √≠t nh·∫•t ___ k√Ω t·ª±.",answers:[
    {text:"4 k√Ω t·ª±",correct:false},
    {text:"8 k√Ω t·ª±",correct:true},
    {text:"2 k√Ω t·ª±",correct:false}]},
  {q:"Kh√¥ng n√™n s·ª≠ d·ª•ng ___ trong m·∫≠t kh·∫©u.",answers:[
    {text:"t√™n ng∆∞·ªùi th√¢n ho·∫∑c ng√†y sinh",correct:true},
    {text:"k√Ω t·ª± ƒë·∫∑c bi·ªát",correct:false},
    {text:"ch·ªØ v√† s·ªë",correct:false}]},
  {q:"N√™n thay ƒë·ªïi m·∫≠t kh·∫©u ___ ƒë·ªÉ tr√°nh b·ªã hack.",answers:[
    {text:"kh√¥ng bao gi·ªù",correct:false},
    {text:"th∆∞·ªùng xuy√™n",correct:true},
    {text:"ch·ªâ khi b·ªã qu√™n",correct:false}]},
  {q:"Kh√¥ng n√™n s·ª≠ d·ª•ng ___ gi·ªëng nhau cho nhi·ªÅu t√†i kho·∫£n.",answers:[
    {text:"m·∫≠t kh·∫©u",correct:true},
    {text:"email",correct:false},
    {text:"t√™n ƒëƒÉng nh·∫≠p",correct:false}]}];

let adviceIndex=0;
function showAdviceGame(){ adviceIndex=0; showAdviceQuestion(); }
function showAdviceQuestion(){
  if(adviceIndex>=adviceQuestions.length){ advicePopup.style.display='none'; showOutro(); return; }
  const q=adviceQuestions[adviceIndex];
  adviceQuestionEl.textContent=q.q;
  adviceAnswersDiv.innerHTML="";
  q.answers.forEach(ans=>{
    const btn=document.createElement('button');
    btn.textContent=ans.text;
    btn.onclick=()=>{
      if(ans.correct){ correctSound.currentTime=0; correctSound.play(); alert("Ch·ªçn ƒë√∫ng! üéâ"); adviceIndex++; }
      else{ wrongSound.currentTime=0; wrongSound.play(); alert("Sai, th·ª≠ l·∫°i üò¢"); }
      showAdviceQuestion();
    };
    adviceAnswersDiv.appendChild(btn);
  });
  advicePopup.style.display='block';
}

// --- OUTRO ---
function showOutro(){
  advicePopup.style.display='none';
  gameArea.style.display='none';
  gameTitle.style.display='none';
  towerGuide.style.display='none';
  outroScreen.style.display='flex';
  setTimeout(()=>document.getElementById('outroTitle').style.opacity=1,100);
  setTimeout(()=>document.getElementById('outroText').style.opacity=1,1100);
  setTimeout(()=>outroChar.style.opacity=1,2100);
}

// --- H∆Ø·ªöNG D·∫™N TH√ÅP ---
function openTowerGuide(){
  document.getElementById('towerGuidePopup').style.display='flex';
}

function closeTowerGuide(){
  document.getElementById('towerGuidePopup').style.display='none';
  typeIntro();  // << B·∫ÆT ƒê·∫¶U INTRO SAU KHI ·∫§N ƒê√ìNG
}
</script>

<!-- ======= APPENDED SCRIPT: ch√∫c m·ª´ng ‚Üí video ‚Üí quiz (KH√îNG S·ª¨A GAME) ======= -->
<script>
/*
  L∆ØU √ù: ƒëo·∫°n n√†y ch·ªâ "th√™m" ch·ª©c nƒÉng m·ªõi.
  - Khi h√†m showOutro() ƒë∆∞·ª£c g·ªçi, n√≥ s·∫Ω hi·ªÉn th·ªã popup ch√∫c m·ª´ng (m√¨nh ghi ƒë√® h√†m runtime).
  - Sau khi ho√†n t·∫•t quiz, h√†m showOutro g·ªëc s·∫Ω ƒë∆∞·ª£c g·ªçi ƒë·ªÉ hi·ªÉn th·ªã outro ban ƒë·∫ßu.
*/

// L∆∞u h√†m showOutro g·ªëc
const originalShowOutro = window.showOutro;

// N·∫øu kh√¥ng t·ªìn t·∫°i h√†m g·ªëc (tr∆∞·ªùng h·ª£p), ƒë·∫£m b·∫£o originalShowOutro l√† null
// (trong file g·ªëc, showOutro lu√¥n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a n√™n originalShowOutro s·∫Ω l√† function)
if (typeof originalShowOutro !== 'function') {
  // kh√¥ng c√≥ h√†m g·ªëc ‚Äî define 1 h√†m m·∫∑c ƒë·ªãnh an to√†n
  window.showOutro = function(){
    document.getElementById('outroScreen').style.display='flex';
  };
} else {
  // GHI ƒê√à showOutro b·∫±ng 1 h√†m m·ªõi, nh∆∞ng s·∫Ω g·ªçi originalShowOutro sau khi quiz xong
  window.showOutro = function(){
    // Hi·ªán popup ch√∫c m·ª´ng (m·ªõi)
    document.getElementById('congratsPopup').style.display = 'block';
  };
}

// DOM elements for new flow
const congratsPopup = document.getElementById('congratsPopup');
const watchVideoBtn = document.getElementById('watchVideoBtn');
const skipToQuizBtn = document.getElementById('skipToQuizBtn');
const videoPopup = document.getElementById('videoPopup');
const lessonVideo = document.getElementById('lessonVideo');
const skipVideoBtn = document.getElementById('skipVideoBtn');
const quizPopup = document.getElementById('quizPopup');
const quizBody = document.getElementById('quizBody');
const nextQuizBtn = document.getElementById('nextQuizBtn');

// ƒê·ªãnh nghƒ©a n·ªôi dung 4 c√¢u h·ªèi theo y√™u c·∫ßu (m·ªôt s·ªë c√¢u cho ph√©p nhi·ªÅu ƒë√°p √°n)
const finalQuiz = [
  {
    id: 1,
    type: 'single', // single-choice
    q: 'C√¢u 1: ƒê√¢u "KH√îNG" ph·∫£i l√† nguy√™n nh√¢n khi·∫øn Minh b·ªã l·ª´a ƒë·∫£o qua m·∫°ng?',
    options: [
      'Tin t∆∞·ªüng v√†o b·∫°n b√®',
      'H·∫•p t·∫•p, thi·∫øu suy nghƒ©',
      'V√¨ nh√† Minh gi√†u'
    ],
    correctIndex: 2 // "V√¨ nh√† Minh gi√†u" l√† ƒë√°p √°n ƒë√∫ng (kh√¥ng ph·∫£i nguy√™n nh√¢n)
  },
  {
    id: 2,
    type: 'multi', // multiple-choice (ch·ªçn t·∫•t c·∫£ th·ªß ƒëo·∫°n ƒë√£ d√πng)
    q: 'C√¢u 2: ƒê·ªëi t∆∞·ª£ng l·ª´a ƒë·∫£o ƒë√£ s·ª≠ d·ª•ng nh·ªØng th·ªß ƒëo·∫°n n√†o ƒë·ªÉ khi·∫øn nh√¢n v·∫≠t tin l√† th·∫≠t? (Ch·ªçn nh·ªØng c√¢u ƒë√∫ng)',
    options: [
      'A. Gi·∫£ m·∫°o t√†i kho·∫£n b·∫°n b√® v√† nh·∫Øn tin v·ªõi gi·ªçng ƒëi·ªáu quen thu·ªôc.',
      'B. Ti·∫øp c·∫≠n n·∫°n nh√¢n l√†m quen v√† d·∫ßn d·∫ßn tr·ªü th√†nh b·∫°n b√® ƒë·ªÉ l·ª´a ƒë·∫£o',
      'C. H·ªëi th√∫c nh√¢n v·∫≠t th·ª±c hi·ªán nhanh ƒë·ªÉ ‚Äúkh√¥ng b·ªè l·ª° c∆° h·ªôi‚Äù.'
    ],
    // Trong t√¨nh hu·ªëng m√¥ t·∫£, c·∫£ A, B, C ƒë·ªÅu l√† th·ªß ƒëo·∫°n ƒë∆∞·ª£c s·ª≠ d·ª•ng ‚Üí n√™n t·∫•t c·∫£ ƒë·ªÅu ƒë√∫ng
    correctIndexes: [0,1,2]
  },
  {
    id: 3,
    type: 'multi',
    q: 'C√¢u 3: Sau khi b·ªã l·ª´a ƒë·∫£o, nh√¢n v·∫≠t ƒë√£ g·∫∑p ph·∫£i h·∫≠u qu·∫£ g√¨? (Ch·ªçn nh·ªØng c√¢u ƒë√∫ng)',
    options: [
      'M·∫•t ti·ªÅn',
      'L·ªô th√¥ng tin c√° nh√¢n, t√†i kho·∫£n m·∫°ng x√£ h·ªôi b·ªã chi·∫øm quy·ªÅn.',
      'B·ªã ƒëe d·ªça, l√†m phi·ªÅn ho·∫∑c ti·∫øp t·ª•c b·ªã nh·∫Øn tin l·ª´a ƒë·∫£o.'
    ],
    // T·∫•t c·∫£ ƒë·ªÅu l√† h·∫≠u qu·∫£ kh·∫£ dƒ© ‚Üí coi c·∫£ 3 l√† ƒë√∫ng
    correctIndexes: [0,1,2]
  },
  {
    id: 4,
    type: 'multi',
    q: 'C√¢u 4: Th√¥ng ƒëi·ªáp c·ªßa ƒëo·∫°n video tr√™n l√† g√¨? (Ch·ªçn t·∫•t c·∫£ c√¢u ƒë√∫ng)',
    options: [
      'Kh√¥ng n√™n tin t∆∞·ªüng tuy·ªát ƒë·ªëi v√†o b·∫•t k·ª≥ ai tr√™n m·∫°ng, k·ªÉ c·∫£ ng∆∞·ªùi quen.',
      'Internet lu√¥n an to√†n n√™n c√≥ th·ªÉ tho·∫£i m√°i chia s·∫ª th√¥ng tin c√° nh√¢n',
      'C·∫£nh gi√°c v·ªõi ƒë∆∞·ªùng link, qu√† t·∫∑ng, ∆∞u ƒë√£i ƒë∆∞·ª£c g·ª≠i ƒë·ªôt ng·ªôt.'
    ],
    // ƒê√°p √°n ƒë√∫ng: 1 v√† 3 (khuy·∫øn c√°o c·∫£nh gi√°c; c√¢u 2 sai)
    correctIndexes: [0,2]
  }
];

let quizIndex = 0;

// H√†m hi·ªÉn th·ªã c√¢u h·ªèi quiz hi·ªán t·∫°i
function renderQuizQuestion(){
  const item = finalQuiz[quizIndex];
  quizBody.innerHTML = '';
  const title = document.createElement('div');
  title.style.fontWeight = '700';
  title.style.marginBottom = '8px';
  title.textContent = item.q;
  quizBody.appendChild(title);

  if(item.type === 'single'){
    const wrap = document.createElement('div');
    wrap.className = 'quiz-answers';
    item.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.onclick = () => {
        // ki·ªÉm tra
        if(i === item.correctIndex){
          correctSound.currentTime = 0; correctSound.play();
          alert('Ch√≠nh x√°c! üéâ');
          quizIndex++;
          if(quizIndex >= finalQuiz.length){
            finishQuizFlow();
          } else {
            renderQuizQuestion();
          }
        } else {
          wrongSound.currentTime = 0; wrongSound.play();
          alert('Sai r·ªìi, th·ª≠ l·∫°i nh√© üò¢');
        }
      };
      wrap.appendChild(btn);
    });
    quizBody.appendChild(wrap);
    // n√∫t next ·∫©n v·ªõi c√¢u single (b·∫•m ƒë√°p √°n s·∫Ω t·ª± chuy·ªÉn)
    nextQuizBtn.style.display = 'none';
  } else if(item.type === 'multi'){
    // hi·ªÉn th·ªã checkbox + n√∫t submit
    const box = document.createElement('div');
    box.className = 'checkbox-row';
    item.options.forEach((opt, i) => {
      const label = document.createElement('label');
      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.dataset.idx = i;
      cb.style.marginRight = '8px';
      label.appendChild(cb);
      const span = document.createElement('span');
      span.textContent = opt;
      label.appendChild(span);
      box.appendChild(label);
    });
    quizBody.appendChild(box);

    // show submit button
    nextQuizBtn.style.display = 'inline-block';
    nextQuizBtn.textContent = 'N·ªôp ƒë√°p √°n';
    // ƒë·∫£m b·∫£o listener kh√¥ng b·ªã ƒëƒÉng k√Ω nhi·ªÅu l·∫ßn
    nextQuizBtn.onclick = () => {
      const checked = Array.from(box.querySelectorAll('input[type="checkbox"]:checked')).map(n=>parseInt(n.dataset.idx));
      // sort for comparison
      checked.sort((a,b)=>a-b);
      const correct = item.correctIndexes.slice().sort((a,b)=>a-b);
      // compare arrays
      if(checked.length === correct.length && checked.every((v,i)=>v === correct[i])){
        correctSound.currentTime = 0; correctSound.play();
        alert('Ch√≠nh x√°c! üéâ');
        quizIndex++;
        if(quizIndex >= finalQuiz.length){
          finishQuizFlow();
        } else {
          renderQuizQuestion();
        }
      } else {
        wrongSound.currentTime = 0; wrongSound.play();
        alert('Ch∆∞a ch√≠nh x√°c. H√£y ki·ªÉm tra l·∫°i v√† th·ª≠ l·∫°i nh√© üò¢');
      }
    };
  }
}

// Ho√†n t·∫•t quiz ‚Üí g·ªçi outro g·ªëc ƒë·ªÉ hi·ªÉn th·ªã m√†n outro c≈©
function finishQuizFlow(){
  // ƒë√≥ng quiz popup
  quizPopup.style.display = 'none';
  congratsPopup.style.display = 'none';
  videoPopup.style.display = 'none';
  // g·ªçi showOutro g·ªëc (originalShowOutro) n·∫øu c√≥
  if (typeof originalShowOutro === 'function') {
    // g·ªçi l·∫°i h√†m g·ªëc ƒë·ªÉ hi·ªÉn th·ªã outro m·∫∑c ƒë·ªãnh
    originalShowOutro();
  } else {
    // fallback: hi·ªÉn th·ªã outroScreen n·∫øu kh√¥ng c√≥ h√†m g·ªëc
    document.getElementById('outroScreen').style.display = 'flex';
  }
}

// S·ª± ki·ªán cho n√∫t tr√™n popup ch√∫c m·ª´ng
watchVideoBtn.onclick = () => {
  congratsPopup.style.display = 'none';
  // show video popup
  videoPopup.style.display = 'block';
  // reset video to start
  try { lessonVideo.currentTime = 0; } catch(e){}
  lessonVideo.play().catch(()=>{});
};

skipToQuizBtn.onclick = () => {
  congratsPopup.style.display = 'none';
  // B·∫Øt ƒë·∫ßu quiz tr·ª±c ti·∫øp
  quizIndex = 0;
  quizPopup.style.display = 'block';
  renderQuizQuestion();
};

// S·ª± ki·ªán cho n√∫t b·ªè qua video
skipVideoBtn.onclick = () => {
  try { lessonVideo.pause(); } catch(e){}
  videoPopup.style.display = 'none';
  quizIndex = 0;
  quizPopup.style.display = 'block';
  renderQuizQuestion();
};

// Khi video k·∫øt th√∫c ‚Üí b·∫Øt ƒë·∫ßu quiz
lessonVideo.onended = () => {
  videoPopup.style.display = 'none';
  quizIndex = 0;
  quizPopup.style.display = 'block';
  renderQuizQuestion();
};

// ƒê√≥ng t·∫•t c·∫£ popup khi nh·∫•n ra ngo√†i (tu·ª≥ ch·ªçn) ‚Äî kh√¥ng b·∫Øt bu·ªôc
// (Kh√¥ng g·∫Øn s·ª± ki·ªán ƒë√≥ng khi b·∫•m ngo√†i ƒë·ªÉ tr√°nh v√¥ t√¨nh ƒë√≥ng)

// === T·∫†M D·ª™NG NH·∫†C N·ªÄN KHI XEM VIDEO ===
(function(){
  try {
    const bgMusicEl = document.getElementById('bgMusic');
    const lessonVideoEl = document.getElementById('lessonVideo');
    const skipVideoBtnEl = document.getElementById('skipVideoBtn');

    if(!bgMusicEl || !lessonVideoEl || !skipVideoBtnEl) return;

    // Khi video b·∫Øt ƒë·∫ßu ph√°t ‚Üí t·∫°m d·ª´ng nh·∫°c n·ªÅn
    lessonVideoEl.addEventListener('play', () => {
      try { bgMusicEl.pause(); } catch(e){}
    });

    // Khi video k·∫øt th√∫c ‚Üí ti·∫øp t·ª•c nh·∫°c n·ªÅn
    lessonVideoEl.addEventListener('ended', () => {
      try { bgMusicEl.play().catch(()=>{}); } catch(e){}
    });

    // Khi ng∆∞·ªùi b·∫•m "B·ªè qua video" ‚Üí ti·∫øp t·ª•c nh·∫°c n·ªÅn
    skipVideoBtnEl.addEventListener('click', () => {
      try { bgMusicEl.play().catch(()=>{}); } catch(e){}
    });

  } catch(e){}
})();
</script>

</body>
</html>

